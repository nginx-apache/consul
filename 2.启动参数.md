
# 2.console 参数

* `-advertise` 通知地址用于更改我们通知到群集中其他节点的地址。
默认情况下，`-bind`地址将被通知。
但是，在某些情况下，可能存在无法绑定的可路由地址。
此标志允许使用其他地址进行传播以支持此功能。
如果这个地址不可路由，那么节点将处于一个恒定的震荡状态，因为其他节点将不可路由性视为失败。
在Consul 1.0和更高版本中，可以将其设置为go sockaddr模板。

* `-advertise-wan` 通知广域网地址用于更改我们公布到通过广域网加入的服务器节点的地址。
当与`translate_wan_addrs`配置选项结合使用时，也可以在客户机代理上设置此选项。
默认情况下，将通知`-advertise`地址。但是，在某些情况下，所有数据中心的所有成员都不能在同一物理或虚拟网络上，特别是在混合云和私有数据中心的混合设置上。
此标志允许服务器节点通过广域网的公共网络交互，同时使用专用VLAN交互以及它们的客户端代理，如果远程数据中心配置了`translate-wan-addrs`，则当从远程数据中心访问时，它允许在此地址访问客户端代理。
在Consul 1.0和更高版本中，可以将其设置为go sockaddr模板

* `-bootstrap` 此标志用于控制服务器是否处于“引导”模式。
在这种模式下，每个数据中心运行的服务器不能超过一台，这一点很重要。
从技术上讲，一个处于引导模式的服务器可以自行选择作为`raft leader`。
只有一个节点处于这种模式是很重要的；否则，由于多个节点能够自行选择，因此无法保证一致性。
不建议在引导群集后使用此标志。

* `-bootstrap-expect` 此标志提供数据中心中预期的服务器数。
不应提供该值，或者该值必须与群集中的其他服务器一致。
当提供时，consul等待指定数量的服务器可用，然后引导集群。这允许自动选择初始领导。
这不能与`legacy-bootstrap`标志一起使用。此标志需要`-server`模式

* `-bind` 内部群集通信应绑定到的地址。这是集群中所有其他节点都应该可以访问的IP地址。
默认情况下，这是“0.0.0.0”，意味着Consul将绑定到本地计算机上的所有地址，并将第一个可用的专用IPv4地址通知到集群的其余部分。
如果存在多个可用的专用IPv4地址，则Consul将在启动时退出并出现错误。如果指定“[：：]”，Consul将公布第一个可用的公共IPv6地址。
如果存在多个可用的公共IPv6地址，则Consul将在启动时退出并出现错误。Consul同时使用TCP和UDP，并为两者使用相同的端口。
如果您有防火墙，请确保允许这两种协议。在Consul 1.0和更高版本中，可以将其设置为Go-SockAddr模板，该模板需要解析为单个地址。

* `-serf-wan-bind` 应该绑定到的用于serf-wan `gossip`通信的地址。
默认情况下，该值遵循与`-bind`命令行标志相同的规则，如果未指定该规则，则使用`-bind`选项。
在Consul 0.7.1及更高版本中提供。在Consul 1.0和更高版本中，可以将其设置为go sockaddr模板。

* `-serf-lan-bind` SERF LAN `gossip`通信应绑定到的地址。
这是一个IP地址，集群中的所有其他LAN节点都应该可以访问它。
默认情况下，该值遵循与-bind命令行标志相同的规则，如果未指定该规则，则使用`-bind`选项。
在Consul 0.7.1及更高版本中提供。在Consul 1.0和更高版本中，可以将其设置为go sockaddr模板。

* `-client` Consul将绑定客户端接口（包括HTTP和DNS服务器）的地址。默认情况下，这是“127.0.0.1”，只允许环回连接。
在Consul 1.0和更高版本中，可以将其设置为要绑定到的地址的空间分隔列表，或者设置为可能解析为多个地址的go-sockaddr模板。

* `-config-file` 要加载的配置文件。有关此文件格式的详细信息，请阅读配置文件部分。
可以多次指定此选项以加载多个配置文件。如果多次指定，以后加载的配置文件将与以前加载的配置文件合并。
在配置合并期间，单值键（string、int、bool）只需替换它们的值，而列表类型将被附加在一起。

* `-config-dir` 要加载的配置文件目录。Consul将加载此目录中后缀为“.json”或“.hcl”的所有文件。
加载顺序是按字母顺序排列的，与上面的配置文件选项使用相同的合并例程。可以多次指定此选项以加载多个目录。
未加载配置目录的子目录。有关配置文件格式的详细信息，请参阅配置文件部分。

* `-config-format` 要加载的配置文件的格式。通常，consul从扩展名“.json”或“.hcl”检测配置文件的格式。
将此选项设置为“json”或“hcl”，将强制consul以该格式解释具有或不具有扩展名的任何文件。

* `-data-dir` 此标志为代理存储状态提供数据目录。这对所有代理都是必需的。重新启动时目录应该是持久的。
这对于以服务器模式运行的代理尤其重要，因为它们必须能够保持集群状态。此外，目录必须支持使用文件系统锁定，这意味着某些类型的已装入文件夹（例如，virtualbox共享文件夹）可能不适用。
注意：服务器和非服务器代理都可以将状态为acl的令牌存储在此目录中，因此读访问可以授予对服务器上任何令牌以及在服务注册期间在非服务器上使用的任何令牌的访问权。
在基于Unix的平台上，文件是以0600权限写入的，因此您应该确保只有受信任的进程可以作为Consul的同一用户执行。
在Windows上，应确保目录具有适当的权限，因为这些权限将被继承。

* `-datacenter` 此标志控制运行代理的数据中心。如果未提供，则默认为“DC1”。Consul对多个数据中心具有一流的支持，但它依赖于正确的配置。同一数据中心中的节点应位于单个LAN上。

* `-dev` 启用开发服务器模式。这对于在关闭所有持久性选项的情况下快速启动Consul代理非常有用，从而启用内存中的服务器，该服务器可用于快速原型化或针对API进行开发。
在此模式下，Connect已启用，默认情况下将在启动时创建一个新的根CA证书。此模式不适用于生产使用，因为它不会将任何数据写入磁盘。在此模式下，GRPC端口也默认为8502。

* `-disable-host-node-id` 将此设置为true将阻止Consul使用主机中的信息生成确定的节点ID，而将生成随机的节点ID，该ID将保留在数据目录中。
在同一主机上运行多个Consul代理进行测试时，这很有用。在版本0.8.5之前的Consul和0.8.5以及更高版本中，这默认为false，因此您必须选择基于主机的ID。
基于主机的ID是使用`https://github.com/shirou/gopsutil/tree/master/host`生成的，它与hashicorp的nomad共享，因此如果您选择使用基于主机的ID，那么consul和nomad将使用主机上的信息自动在两个系统中分配相同的ID。

* `-disable-keyring-file` 如果设置，则不会将钥匙圈持久化到文件中。任何已安装的密钥在关闭时都将丢失，并且只有给定的`-encrypt`密钥在启动时可用。默认为假。

* `-dns-port` 要侦听的DNS端口。这将覆盖默认端口`8600`。这在consul 0.7及以后提供。

* `-domain` 默认情况下，Consul响应“Consul.”域中的DNS查询。此标志可用于更改该域。该域中的所有查询都假定由Consul处理，并且不会被递归解析。

* `-enable-script-checks` 这控制是否在此代理上启用执行脚本的运行状况检查，并默认为false，因此操作员必须选择允许这些检查。这是在Consul 0.9.0中添加的。
安全警告：在某些配置中启用脚本检查可能会导致远程执行漏洞，已知该漏洞是恶意软件的目标。强烈建议启用本地脚本检查。有关详细信息，请参阅此日志。  

* `-enable-local-script-checks` 与启用脚本检查类似，但仅当在本地配置文件中定义它们时才启用它们。同样的不允许`HTTP API`注册中定义的脚本检查。

* `-encrypt` 指定用于加密Consul网络流量的密钥。此密钥必须是base64编码的16个字节。创建加密密钥的最简单方法是使用`consul keygen`。
集群中的所有节点必须共享相同的加密密钥才能进行通信。提供的密钥将自动保留到数据目录，并在代理重新启动时自动加载。这意味着要加密Consul的`gossip`协议，该选项只需要在每个代理的初始启动序列上提供一次。
如果在使用加密密钥初始化Consul之后提供，则忽略提供的密钥并显示警告。

* `-grpc-port` 要侦听的GRPC API端口。默认值-1（GRPC已禁用）。有关更多详细信息，请参阅端口文档。

* `-hcl` 一个HCL配置片段。此`HCL`配置片段被用于配置和允许，以具体说明在命令线上的一个配置文件选项的全部范围。此选项可具体规定多次时间。这是在Consul 1.0中添加的。

* `-http-port` 要侦听的`HTTP API`端口。这将覆盖默认端口`8500`。此选项在将Consul部署到通过环境（如类似于CloudFoundry的Paas）通信HTTP端口的环境时非常有用，允许您通过procFile直接设置端口。

* `-log-file` 此配置将所有的consul代理日志消息重定向到一个文件中。此处可以指定为日志文件的完整路径，如果路径没有文件名，则文件名默认为`consul-{timestamp}.log`。
可以与`-log-rotate-bytes`和`-log-rotate-duration`结合使用，以获得细粒度日志旋转体验。

* `-log-rotate-bytes` 指定需要旋转日志之前应写入日志的字节数。除非指定，否则对可以写入日志文件的字节数没有限制。

* `-log-rotate-duration` 要指定日志在需要旋转之前应写入的最长持续时间。必须是持续时间值，如30秒。默认为24小时。

* `-join` 启动时要加入的另一个代理的地址。可以多次指定，以指定要加入的多个代理。如果Consul无法与任何指定地址联接，代理启动将失败。
默认情况下，代理在启动时不会加入任何节点。请注意，在自动化Consul集群部署时，使用retry_join可能更适合帮助缓解节点启动争用条件。在Consul 1.1.0和更高版本中，可以将其设置为go sockaddr模板。

* `-retry-join` 类似于`-join`，但允许在第一次尝试失败时重试join。这对于您知道地址最终将可用的情况很有用。列表可以包含IPv4、IPv6或DNS地址。在Consul 1.1.0和更高版本中，可以将其设置为go sockaddr模板。
如果Consul在非默认SERF LAN端口上运行，则也必须指定该端口。IPv6必须使用“括号”语法。如果给定了多个值，则按列出的顺序重试，直到第一个值成功为止。以下是一些例子：

```shell
# Using a DNS entry
$ consul agent -retry-join "consul.domain.internal"
# Using IPv4
$ consul agent -retry-join "10.0.4.67"
# Using IPv6
$ consul agent -retry-join "[::1]:8301"
```

* `-retry-interval` 在连接尝试之间等待的时间。默认为30秒。 

* `-retry-max` 退出前尝试加入的最大次数，返回代码为1。默认情况下，设置为0，这被解释为无限重试。

* `-join-wan` 启动时要加入的另一个WAN代理的地址。可以多次指定，以指定要加入的多个广域网代理。如果Consul无法与任何指定地址联接，代理启动将失败。
默认情况下，代理在启动时不会连接任何节点。在Consul 1.1.0和更高版本中，可以将其设置为go sockaddr模板。

* `-retry-join-wan` 类似于`-retry-join`，但允许在第一次尝试失败时重试广域网联接。这对于我们知道地址最终将可用的情况很有用。自Consul 0.9.3起，也支持云自动加入。
在Consul 1.1.0和更高版本中，可以将其设置为go sockaddr模板。

* `-retry-interval-wan` 在`-join-wan`尝试之间等待的时间。默认为30秒。 